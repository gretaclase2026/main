
<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vocabulari Social C1 - Vibrant</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#ececec;color:#333}
.card{max-width:720px;margin:20px auto;background:#fff;border-radius:24px;padding:24px;box-shadow:0 8px 18px rgba(0,0,0,.15);position:relative}
.modes{display:flex;gap:10px;margin-bottom:10px;width:100%}
.mode{flex:1;text-align:center;padding:14px;border-radius:24px;font-weight:bold;cursor:pointer;border:2px solid transparent}
.mode.en{background:#d6e6f5}
.mode.es{background:#f4d6e6}
.mode.active{border-color:#999;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.blocks{display:flex;flex-wrap:wrap;gap:8px;margin:15px 0}
.block{width:40px;height:40px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;font-weight:bold;background:#fff4cc;cursor:pointer;transition:0.2s}
.block.active{background:#ffcc00;transform:scale(1.1);box-shadow:inset 0 0 5px rgba(0,0,0,0.2)}
.main-box-container{display:flex;align-items:center;justify-content:center;position:relative;margin:20px 0}
.main-box{text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center}
.audio-btn{font-size:60px;background:#dcfce7;border:none;cursor:pointer;width:140px;height:140px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:0.2s}
.audio-btn.vibrate{animation:vibrate 0.25s linear 2}
@keyframes vibrate{0%{transform:translate(0)}25%{transform:translate(2px,-2px)}50%{transform:translate(-2px,2px)}75%{transform:translate(2px,2px)}100%{transform:translate(0)}}
.counter-side{position:absolute;right:10px;font-weight:bold;color:#2563eb;font-size:22px}
#word{font-size:24px;font-weight:800;margin:20px 0;line-height:1.4;min-height:120px;text-align:center;display:flex;align-items:center;justify-content:center;padding:0 10px}
.txt-es{color:#2563eb} 
#answer{font-size:20px;font-weight:bold;margin-top:-10px;margin-bottom:20px;text-align:center;min-height:30px;color:#666}
.actions{display:flex;gap:12px}
.btn{flex:1;padding:18px;border-radius:18px;border:none;font-weight:bold;font-size:18px;cursor:pointer}
.btn-reveal{background:#e0f2fe}
.btn-know{background:#dcfce7}
.btn-next{background:#fbcfe8}
#list{margin-top:20px;background:#f9f9f9;padding:15px;border-radius:15px;display:none;border:1px solid #ddd}
</style>
</head>
<body>

<div class="card">
  <div class="modes">
    <div id="modeEN" class="mode en active" onclick="setMode('EN')">ENG ‚Üí ESP</div>
    <div id="modeES" class="mode es" onclick="setMode('ES')">ESP ‚Üí ENG</div>
  </div>

  <div class="blocks" id="blocksContainer"></div>

  <div class="main-box-container">
    <div class="main-box">
      <button class="audio-btn" onclick="playAudio()">üîä</button>
    </div>
    <div class="counter-side">
      <span id="pos">0</span> / <span id="total">0</span>
    </div>
  </div>

  <div id="word"></div>
  <div id="answer"></div>

  <div class="actions">
    <button class="btn btn-reveal" onclick="reveal()">veure</button>
    <button class="btn btn-know" onclick="know()">ja la se</button>
    <button class="btn btn-next" onclick="next()">seg√ºent</button>
  </div>
  
  <button id="listBtn" onclick="toggleList()" style="width:100%;margin-top:20px;padding:12px;border-radius:12px;border:none;background:#e9d5ff;font-weight:bold;cursor:pointer">mostrar llista del bloc</button>
  <div id="list"></div>
</div>

<audio id="audio"></audio>

<script>
const data = [
  {en: "I did it this way so she wouldn't have to walk back and forth all the time.", es: "Lo hice as√≠ para que ella no tuviera que ir y venir caminando todo el tiempo"},
  {en: "You ought to try and embrace new challenges if you want to improve your fluency.", es: "Deber√≠as intentar aceptar nuevos retos si quieres mejorar tu fluidez"},
  {en: "The weather has been perfect so far, knock on wood it stays like this.", es: "El tiempo ha sido perfecto hasta ahora, toquemos madera para que siga as√≠"},
  {en: "I've tidied up every room and each one is spotless right now.", es: "He limpiado cada habitaci√≥n y ahora mismo cada una est√° impecable"},
  {en: "My sister and I get along really well, we usually travel together quite often.", es: "Mi hermana y yo nos llevamos muy bien, solemos viajar juntas a menudo"},
  {en: "I got lost and I couldn't find my way back until I used the GPS.", es: "Me perd√≠ y no pude encontrar el camino de vuelta hasta que us√© el GPS"},
  {en: "You should receive an answer from them within three days.", es: "Deber√≠as recibir una respuesta por su parte en un plazo de tres d√≠as"},
  {en: "If you need any further information about the trip, just let me know.", es: "Si necesitas m√°s informaci√≥n sobre el viaje, d√≠melo sin problemas"},
  {en: "I brought some wine so you wouldn't have to walk back and forth to the store.", es: "Traje un poco de vino para que no tuvieras que ir y venir a la tienda"},
  {en: "I thought we would be there within ten minutes, but we got lost.", es: "Pens√© que estar√≠amos all√≠ en diez minutos, pero nos perdimos"},
  {en: "We saw each other yesterday and ate at that new place which is spotless.", es: "Nos vimos ayer y comimos en ese sitio nuevo que est√° impecable"},
  {en: "I bought these flowers to thank you for giving us further directions.", es: "Compr√© estas flores para agradecerte que nos dieras indicaciones adicionales"},
  {en: "I knew it was the right way back as soon as I saw the park.", es: "Supe que era el camino de vuelta correcto en cuanto vi el parque"},
  {en: "I understood I ought to have embraced the challenge when I spoke to them.", es: "Entend√≠ que deber√≠a haber aceptado el reto cuando habl√© con ellos"},
  {en: "I felt the weather was perfect, so we sat outside all night.", es: "Sent√≠ que el tiempo era perfecto, as√≠ que nos quedamos fuera toda la noche"},
  {en: "You ought to try this wine, it's the best I've had in a long time.", es: "Deber√≠as probar este vino, es lo mejor que he probado en mucho tiempo"},
  {en: "Could you give me some further details about what you did yesterday?", es: "¬øPodr√≠as darme m√°s detalles sobre lo que hicisteis ayer?"},
  {en: "We should be at the restaurant within fifteen minutes if there's no traffic.", es: "Deber√≠amos estar en el restaurante en quince minutos si no hay tr√°fico"},
  {en: "I've just tidied up the living room so everything looks spotless for the guests.", es: "Acabo de ordenar el sal√≥n para que todo se vea impecable para los invitados"},
  {en: "They told me they got along with the neighbors right from the start.", es: "Me dijeron que se llevaron bien con los vecinos desde el principio"}
];

let currentBlockData = [];
let pos = 0;
let mode = "EN";
let learnedCount = 0;
let currentBlockID = 0;

function initBlocks() {
  const container = document.getElementById("blocksContainer");
  const numBlocks = Math.ceil(data.length / 10);
  container.innerHTML = "";
  for (let i = 0; i < numBlocks; i++) {
    const btn = document.createElement("button");
    btn.className = "block";
    btn.textContent = i + 1;
    btn.onclick = () => loadBlock(i);
    container.appendChild(btn);
  }
  const btnT = document.createElement("button");
  btnT.className = "block"; btnT.textContent = "T";
  btnT.onclick = () => loadBlock('T');
  container.appendChild(btnT);
  loadBlock(0);
}

function loadBlock(b) {
  currentBlockID = b;
  let temp = [];
  if (b === 'T') {
    temp = data.map((item, i) => ({...item, realIdx: i+1}));
  } else {
    let start = b * 10;
    let end = Math.min(start + 10, data.length);
    for (let i = start; i < end; i++) {
      temp.push({...data[i], realIdx: i+1});
    }
  }
  currentBlockData = temp.sort(() => Math.random() - 0.5);
  
  document.querySelectorAll(".block").forEach((btn) => {
    btn.classList.toggle("active", (b === 'T' && btn.textContent === 'T') || (parseInt(btn.textContent)-1 === b));
  });

  pos = 0; learnedCount = 0;
  document.getElementById("list").style.display = "none";
  update(true); 
}

function setMode(m) {
  mode = m;
  document.getElementById("modeEN").classList.toggle("active", m === "EN");
  document.getElementById("modeES").classList.toggle("active", m === "ES");
  update(true);
}

function update(fromNextAction = false) {
  if (currentBlockData.length === 0) {
    document.getElementById("word").innerHTML = "¬°Bloque Completado! üéâ";
    document.getElementById("answer").innerHTML = "";
    return;
  }
  const item = currentBlockData[pos];
  const translation = `<span class="txt-es">${item.es}</span>`;
  
  const w = document.getElementById("word");
  const a = document.getElementById("answer");

  if (mode === "EN") {
    w.innerHTML = ``; 
    a.innerHTML = translation;
    if (fromNextAction) playAudio();
  } else {
    w.innerHTML = `<div style='font-size:22px;'>${translation}</div>`;
    a.innerHTML = `<span style="font-size:24px;">${item.en}</span>`;
  }
  
  a.style.display = "none";
  document.getElementById("pos").textContent = learnedCount;
  document.getElementById("total").textContent = currentBlockData.length + learnedCount;
}

function reveal() {
  if (currentBlockData.length > 0) {
    const item = currentBlockData[pos];
    if (mode === "EN") {
        document.getElementById("word").innerHTML = `<span style="color:#333;">${item.en}</span>`;
    }
    document.getElementById("answer").style.display = "block";
    if (mode === "ES") playAudio(); 
  }
}

function know() {
  if (currentBlockData.length === 0) return;
  learnedCount++;
  currentBlockData.splice(pos, 1);
  if (pos >= currentBlockData.length) pos = 0;
  update(true);
}

function next() {
  if (currentBlockData.length === 0) return;
  pos = (pos + 1) % currentBlockData.length;
  update(true);
}

function playAudio() {
  if (currentBlockData.length === 0) return;
  const num = currentBlockData[pos].realIdx;
  const a = document.getElementById("audio");
  a.src = "frase" + num + ".mp3";
  const btn=document.querySelector('.audio-btn');
  btn.classList.remove('vibrate'); void btn.offsetWidth; btn.classList.add('vibrate');
  a.play().catch(() => {});
}

function toggleList() {
  const l = document.getElementById("list");
  if (l.style.display === "block") { l.style.display = "none"; return; }
  l.innerHTML = "<b>Llista del bloc:</b><br><br>";
  let start = currentBlockID === 'T' ? 0 : currentBlockID * 10;
  let end = currentBlockID === 'T' ? data.length : Math.min(start + 10, data.length);
  let originalBlock = data.slice(start, end);
  originalBlock.forEach((item) => {
    l.innerHTML += `<div style="margin-bottom:8px"><b>${item.en}</b> - <span class="txt-es">${item.es}</span></div>`;
  });
  l.style.display = "block";
}

initBlocks();

const style = document.createElement('style');
style.innerHTML = `
    .check-box-manual {
        position: absolute;
        top: 85px; 
        right: 22px;
        width: 24px;
        height: 24px;
        background: #fff !important;
        border: 1.5px solid #22c55e !important;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.2s;
        font-size: 14px;
    }
    .check-box-manual.marked { 
        background: #22c55e !important; 
        color: white; 
    }
`;
document.head.appendChild(style);

function getFolderName() {
    const path = window.location.pathname;
    return path.split('/').filter(Boolean).slice(-2, -1)[0] || "unknown";
}

function markAsDone(element) {
    localStorage.setItem(getFolderName(), new Date().toISOString());
    element.innerHTML = "‚úì";
    element.classList.add('marked');
    alert("Lli√ß√≥ marcada ‚úÖ");
}

const card = document.querySelector(".card");
const box = document.createElement("div");
box.className = "check-box-manual";

if (localStorage.getItem(getFolderName())) {
    box.innerHTML = "‚úì";
    box.classList.add('marked');
}

box.onclick = function() { markAsDone(this); };
card.appendChild(box);
</script>
</body>
</html>