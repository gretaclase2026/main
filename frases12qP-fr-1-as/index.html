 <!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vocabulari Social C1 - Vibrant</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#ececec;color:#333}
.card{max-width:720px;margin:20px auto;background:#fff;border-radius:24px;padding:24px;box-shadow:0 8px 18px rgba(0,0,0,.15);position:relative}
.modes{display:flex;gap:10px;margin-bottom:10px;width:100%}
.mode{flex:1;text-align:center;padding:14px;border-radius:24px;font-weight:bold;cursor:pointer;border:2px solid transparent}
.mode.en{background:#d6e6f5}
.mode.es{background:#f4d6e6}
.mode.active{border-color:#999;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.blocks{display:flex;flex-wrap:wrap;gap:8px;margin:15px 0}
.block{width:40px;height:40px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;font-weight:bold;background:#fff4cc;cursor:pointer;transition:0.2s}
.block.active{background:#ffcc00;transform:scale(1.1);box-shadow:inset 0 0 5px rgba(0,0,0,0.2)}
.main-box-container{display:flex;align-items:center;justify-content:center;position:relative;margin:20px 0}
.main-box{text-align:center;display:flex;flex-direction:row;justify-content:center;align-items:center;gap:15px}
.audio-btn{font-size:45px;background:#dcfce7;border:none;cursor:pointer;width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:0.2s}
.audio-btn.slow{background:#fef08a; font-size: 35px;}
.audio-btn.vibrate{animation:vibrate 0.25s linear 2}
@keyframes vibrate{0%{transform:translate(0)}25%{transform:translate(2px,-2px)}50%{transform:translate(-2px,2px)}75%{transform:translate(2px,2px)}100%{transform:translate(0)}}
.counter-side{position:absolute;right:10px;font-weight:bold;color:#2563eb;font-size:22px}
#word{font-size:24px;font-weight:800;margin:20px 0;line-height:1.4;min-height:120px;text-align:center;display:flex;align-items:center;justify-content:center;padding:0 10px}
.txt-es{color:#2563eb} 
#answer{font-size:20px;font-weight:bold;margin-top:-10px;margin-bottom:20px;text-align:center;min-height:30px;color:#666}
.actions{display:flex;gap:12px}
.btn{flex:1;padding:18px;border-radius:18px;border:none;font-weight:bold;font-size:18px;cursor:pointer}
.btn-reveal{background:#e0f2fe}
.btn-know{background:#dcfce7}
.btn-next{background:#fbcfe8}
#list{margin-top:20px;background:#f9f9f9;padding:15px;border-radius:15px;display:none;border:1px solid #ddd}
</style>
</head>
<body>

<div class="card">
  <div class="modes">
    <div id="modeEN" class="mode en active" onclick="setMode('EN')">ENG ‚Üí ESP</div>
    <div id="modeES" class="mode es" onclick="setMode('ES')">ESP ‚Üí ENG</div>
  </div>

  <div class="blocks" id="blocksContainer"></div>

  <div class="main-box-container">
    <div class="main-box">
      <button class="audio-btn" id="btnNormal" onclick="playAudio(1.0)" title="Velocitat Normal">üîä</button>
      <button class="audio-btn slow" id="btnSlow" onclick="playAudio(0.75)" title="Velocitat Lenta">üê¢</button>
    </div>
    <div class="counter-side">
      <span id="pos">0</span> / <span id="total">0</span>
    </div>
  </div>

  <div id="word"></div>
  <div id="answer"></div>

  <div class="actions">
    <button class="btn btn-reveal" onclick="reveal()">veure</button>
    <button class="btn btn-know" onclick="know()">ja la se</button>
    <button class="btn btn-next" onclick="next()">seg√ºent</button>
  </div>
  
  <button id="listBtn" onclick="toggleList()" style="width:100%;margin-top:20px;padding:12px;border-radius:12px;border:none;background:#e9d5ff;font-weight:bold;cursor:pointer">mostrar llista del bloc</button>
  <div id="list"></div>
</div>

<audio id="audio"></audio>

<script>
const data = [
  {en: "I did it this way so she wouldn't have to walk back and forth all the time.", es: "Lo hice as√≠ para que ella no tuviera que ir y venir caminando todo el tiempo"},
  {en: "You ought to try and embrace new challenges if you want to improve your fluency.", es: "Deber√≠as intentar aceptar nuevos retos si quieres mejorar tu fluidez"},
  {en: "The weather has been perfect so far, knock on wood it stays like this.", es: "El tiempo ha sido perfecto hasta ahora, toquemos madera para que siga as√≠"},
  {en: "I've tidied up every room and each one is spotless right now.", es: "He limpiado cada habitaci√≥n y ahora mismo cada una est√° impecable"},
  {en: "My sister and I get along really well, we usually travel together quite often.", es: "Mi hermana y yo nos llevamos muy bien, solemos viajar juntas a menudo"},
  {en: "I got lost and I couldn't find my way back until I used the GPS.", es: "Me perd√≠ y no pude encontrar el camino de vuelta hasta que us√© el GPS"},
  {en: "You should receive an answer from them within three days.", es: "Deber√≠as recibir una respuesta por su parte en un plazo de tres d√≠as"},
  {en: "If you need any further information about the trip, just let me know.", es: "Si necesitas m√°s informaci√≥n sobre el viaje, d√≠melo sin problemas"},
  {en: "I brought some wine so you wouldn't have to walk back and forth to the store.", es: "Traje un poco de vino para que no tuvieras que ir y venir a la tienda"},
  {en: "I thought we would be there within ten minutes, but we got lost.", es: "Pens√© que estar√≠amos all√≠ en diez minutos, pero nos perdimos"},
  {en: "We saw each other yesterday and ate at that new place which is spotless.", es: "Nos vimos ayer y comimos en ese sitio nuevo que est√° impecable"},
  {en: "I bought these flowers to thank you for giving us further directions.", es: "Compr√© estas flores para agradecerte que nos dieras indicaciones adicionales"},
  {en: "I knew it was the right way back as soon as I saw the park.", es: "Supe que era el camino de vuelta correcto en cuanto vi el parque"},
  {en: "I understood I ought to have embraced the challenge when I spoke to them.", es: "Entend√≠ que deber√≠a haber aceptado el resto cuando habl√© con ellos"},
  {en: "I felt the weather was perfect, so we sat outside all night.", es: "Sent√≠ que el tiempo era perfecto, as√≠ que nos quedamos fuera toda la noche"},
  {en: "You ought to try this wine, it's the best I've had in a long time.", es: "Deber√≠as probar este vino, es lo mejor que he probado en mucho tiempo"},
  {en: "Could you give me some further details about what you did yesterday?", es: "¬øPodr√≠as darme m√°s detalles sobre lo que hicisteis ayer?"},
  {en: "We should be at the restaurant within fifteen minutes if there's no traffic.", es: "Deber√≠amos estar en el restaurante en quince minutos si no hay tr√°fico"},
  {en: "I've just tidied up the living room so everything looks spotless for the guests.", es: "Acabo de ordenar el sal√≥n para que todo se vea impecable para los invitados"},
  {en: "They told me they got along with the neighbors right from the start.", es: "Me dijeron que se llevaron bien con los vecinos desde el principio"},
  {en: "By the way, I brought some wine so you wouldn't have to walk back and forth to the store.", es: "Por cierto, traje un poco de vino para que no tuvieras que ir y venir a la tienda"},
  {en: "To be honest, I thought we would be there within ten minutes, but we got lost.", es: "Para ser sincera, pens√© que estar√≠amos all√≠ en diez minutos, pero nos perdimos"},
  {en: "Actually, we saw each other yesterday and ate at that new place which is spotless.", es: "De hecho, nos vimos ayer y comimos en ese sitio nuevo que est√° impecable"},
  {en: "If you ask me, you should receive an answer from them within three days.", es: "Si me preguntas a m√≠, deber√≠as recibir una respuesta por su parte en tres d√≠as"},
  {en: "By the way, my sister and I have got along really well since we were kids.", es: "Por cierto, mi hermana y yo nos llevamos muy bien desde que somos peque√±as"},
  {en: "Truth be told, I knew it was the right way back as soon as I saw the park.", es: "A decir verdad, supe que era el camino de vuelta en cuanto vi el parque"},
  {en: "By the way, I bought these flowers to thank you for giving us further details.", es: "Por cierto, compr√© estas flores para agradecerte que nos dieras m√°s detalles"},
  {en: "To be honest, I understood I ought to have embraced the challenge when I spoke to them.", es: "Para ser sincera, entend√≠ que deb√≠a aceptar el reto cuando habl√© con ellos"},
  {en: "As I was saying, the weather was perfect, so we sat outside all night.", es: "Como dec√≠a, el tiempo fue perfecto, as√≠ que nos quedamos fuera toda la noche"},
  {en: "By the way, you don't have to walk back and forth; I'll bring the plates.", es: "Por cierto, no hace falta que vayas y vuelvas; yo traer√© los platos"},
  {en: "Truth be told, you ought to try this wine, it's the best I've had in years.", es: "A decir verdad, deber√≠as probar este vino, es lo mejor que he tomado en a√±os"},
  {en: "Actually, I got lost and I couldn't find my way back without the GPS.", es: "De hecho, me perd√≠ y no pude encontrar el camino de vuelta sin el GPS"},
  {en: "By the way, could you give me some further details about what you did yesterday?", es: "Por cierto, ¬øpodr√≠as darme m√°s detalles sobre lo que hicisteis ayer?"},
  {en: "To be honest, the restaurant is very close, we'll be there within ten minutes.", es: "Para ser sincera, el restaurante est√° muy cerca, estaremos all√≠ en diez minutos"},
  {en: "Actually, I've tidied up the terrace and it's spotless for the dinner.", es: "De hecho, he limpiado la terraza y ha quedado impecable para la cena"},
  {en: "By the way, I hope the weather is perfect tomorrow, knock on wood.", es: "Por cierto, espero que el tiempo sea perfecto ma√±ana, toquemos madera"},
  {en: "As I was saying, we get along really well because we have very similar tastes.", es: "Como dec√≠a, nos llevamos muy bien porque tenemos gustos muy parecidos"},
  {en: "If you ask me, you ought to embrace new challenges to improve your fluency.", es: "Si me preguntas a m√≠, deber√≠as aceptar nuevos retos para mejorar tu fluidez"},
  {en: "By the way, did you bring the dessert we bought at that spotless bakery?", es: "Por cierto, ¬øtrajiste el postre que compramos en esa pasteler√≠a tan limpia?"},
  {en: "Truth be told, I'm glad you didn't have to walk back and forth so much.", es: "A decir verdad, me alegra que no tuvieras que caminar tanto de un lado a otro"},
  {en: "It's been ages since we last caught up, we have so much to talk about!", es: "Hace siglos que no nos ponemos al d√≠a, ¬°tenemos tanto de qu√© hablar!"},
  {en: "I'm a bit tied up at the moment, but I'll call you back as soon as I'm free.", es: "Estoy un poco liada en este momento, pero te devuelvo la llamada en cuanto est√© libre"},
  {en: "To be fair, he's been under a lot of pressure lately so he's a bit stressed.", es: "Para ser justos, √©l ha estado bajo mucha presi√≥n √∫ltimamente, as√≠ que est√° un poco estresado"},
  {en: "I'm in two minds about going out tonight; part of me just wants to stay in.", es: "Estoy indecisa sobre si salir esta noche; una parte de m√≠ solo quiere quedarse en casa"},
  {en: "Better safe than sorry, so I'll bring a jacket just in case it gets chilly.", es: "M√°s vale prevenir que curar, as√≠ que llevar√© una chaqueta por si refresca"},
  {en: "I can't quite put my finger on it, but something feels different in this room.", es: "No sabr√≠a decir exactamente qu√© es, pero algo se siente diferente en esta habitaci√≥n"},
  {en: "We ended up staying at that caf√© for hours because the coffee was so good.", es: "Acabamos qued√°ndonos en esa cafeter√≠a durante horas porque el caf√© estaba muy bueno"},
  {en: "It's not really my cup of tea, but I'm willing to give it a try if you like it.", es: "No es mucho de mi agrado, pero estoy dispuesta a probarlo si a ti te gusta"},
  {en: "I need to figure out how to set up this new app before the meeting starts.", es: "Necesito averiguar c√≥mo configurar esta nueva aplicaci√≥n antes de que empiece la reuni√≥n"},
  {en: "Long story short, we missed the train and had to take a very expensive taxi.", es: "Resumiendo, perdimos el tren y tuvimos que coger un taxi car√≠simo"},
  {en: "As far as I'm concerned, this is the best restaurant in the whole city.", es: "Por lo que a m√≠ respecta, este es el mejor restaurante de toda la ciudad"},
  {en: "I'm really looking forward to seeing everyone at the dinner next weekend.", es: "Tengo much√≠simas ganas de ver a todo el mundo en la cena del pr√≥ximo fin de semana"},
  {en: "Don't worry, it's not the end of the world if we don't finish everything today.", es: "No te preocupes, no es el fin del mundo si no lo terminamos todo hoy"},
  {en: "I've been feeling a bit under the weather lately, so I've been resting a lot.", es: "Me he estado sintiendo un poco pachucha √∫ltimamente, as√≠ que he estado descansando mucho"},
  {en: "You've hit the nail on the head; that's exactly what I was trying to say.", es: "Has dado en el clavo; eso es exactamente lo que estaba intentando decir"},
  {en: "I'll keep my fingers crossed that you get the job, you really deserve it.", es: "Cruzar√© los dedos para que consigas el trabajo, realmente te lo mereces"},
  {en: "It's on the tip of my tongue, but I just can't remember the name of that place.", es: "Lo tengo en la punta de la lengua, pero no consigo recordar el nombre de ese sitio"},
  {en: "I'm swamped with work this week, so I won't be able to join you for lunch.", es: "Estoy inundada de trabajo esta semana, as√≠ que no podr√© ir contigo a comer"},
  {en: "It's up to you; I don't mind which movie we watch as long as there's popcorn.", es: "T√∫ decides; no me importa qu√© pel√≠cula veamos mientras haya palomitas"},
  {en: "I'll get round to fixing that leaky faucet as soon as I have a spare moment.", es: "Sacar√© tiempo para arreglar ese grifo que gotea en cuanto tenga un momento libre"}
];

let currentBlockData = [];
let pos = 0;
let mode = "EN";
let learnedCount = 0;
let currentBlockID = 0;

function initBlocks() {
  const container = document.getElementById("blocksContainer");
  const numBlocks = Math.ceil(data.length / 10);
  container.innerHTML = "";
  for (let i = 0; i < numBlocks; i++) {
    const btn = document.createElement("button");
    btn.className = "block";
    btn.textContent = i + 1;
    btn.onclick = () => loadBlock(i);
    container.appendChild(btn);
  }
  const btnT = document.createElement("button");
  btnT.className = "block"; btnT.textContent = "T";
  btnT.onclick = () => loadBlock('T');
  container.appendChild(btnT);
  loadBlock(0);
}

function loadBlock(b) {
  currentBlockID = b;
  let temp = [];
  if (b === 'T') {
    temp = data.map((item, i) => ({...item, realIdx: i+1}));
  } else {
    let start = b * 10;
    let end = Math.min(start + 10, data.length);
    for (let i = start; i < end; i++) {
      temp.push({...data[i], realIdx: i+1});
    }
  }
  currentBlockData = temp.sort(() => Math.random() - 0.5);
  
  document.querySelectorAll(".block").forEach((btn) => {
    btn.classList.toggle("active", (b === 'T' && btn.textContent === 'T') || (parseInt(btn.textContent)-1 === b));
  });

  pos = 0; learnedCount = 0;
  document.getElementById("list").style.display = "none";
  update(true); 
}

function setMode(m) {
  mode = m;
  document.getElementById("modeEN").classList.toggle("active", m === "EN");
  document.getElementById("modeES").classList.toggle("active", m === "ES");
  update(true);
}

function update(fromNextAction = false) {
  if (currentBlockData.length === 0) {
    document.getElementById("word").innerHTML = "¬°Bloque Completado! üéâ";
    document.getElementById("answer").innerHTML = "";
    return;
  }
  const item = currentBlockData[pos];
  const translation = `<span class="txt-es">${item.es}</span>`;
  
  const w = document.getElementById("word");
  const a = document.getElementById("answer");

  if (mode === "EN") {
    w.innerHTML = ``; 
    a.innerHTML = translation;
    if (fromNextAction) playAudio(1.0);
  } else {
    w.innerHTML = `<div style='font-size:22px;'>${translation}</div>`;
    a.innerHTML = `<span style="font-size:24px;">${item.en}</span>`;
  }
  
  a.style.display = "none";
  document.getElementById("pos").textContent = learnedCount;
  document.getElementById("total").textContent = currentBlockData.length + learnedCount;
}

function reveal() {
  if (currentBlockData.length > 0) {
    const item = currentBlockData[pos];
    if (mode === "EN") {
        document.getElementById("word").innerHTML = `<span style="color:#333;">${item.en}</span>`;
    }
    document.getElementById("answer").style.display = "block";
    if (mode === "ES") playAudio(1.0); 
  }
}

function know() {
  if (currentBlockData.length === 0) return;
  learnedCount++;
  currentBlockData.splice(pos, 1);
  if (pos >= currentBlockData.length) pos = 0;
  update(true);
}

function next() {
  if (currentBlockData.length === 0) return;
  pos = (pos + 1) % currentBlockData.length;
  update(true);
}

function playAudio(speed) {
  if (currentBlockData.length === 0) return;
  const num = currentBlockData[pos].realIdx;
  const a = document.getElementById("audio");
  a.src = "frase" + num + ".mp3";
  a.playbackRate = speed; // Ajustar la velocidad
  
  const btn = speed === 1.0 ? document.getElementById('btnNormal') : document.getElementById('btnSlow');
  btn.classList.remove('vibrate'); void btn.offsetWidth; btn.classList.add('vibrate');
  
  a.play().catch(() => {});
}

function toggleList() {
  const l = document.getElementById("list");
  if (l.style.display === "block") { l.style.display = "none"; return; }
  l.innerHTML = "<b>Llista del bloc:</b><br><br>";
  let start = currentBlockID === 'T' ? 0 : currentBlockID * 10;
  let end = currentBlockID === 'T' ? data.length : Math.min(start + 10, data.length);
  let originalBlock = data.slice(start, end);
  originalBlock.forEach((item) => {
    l.innerHTML += `<div style="margin-bottom:8px"><b>${item.en}</b> - <span class="txt-es">${item.es}</span></div>`;
  });
  l.style.display = "block";
}

initBlocks();

// Mantener tu estilo de la caja de check y l√≥gica de guardado
const style = document.createElement('style');
style.innerHTML = `
    .check-box-manual {
        position: absolute;
        top: 85px; 
        right: 22px;
        width: 24px;
        height: 24px;
        background: #fff !important;
        border: 1.5px solid #22c55e !important;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.2s;
        font-size: 14px;
    }
    .check-box-manual.marked { 
        background: #22c55e !important; 
        color: white; 
    }
`;
document.head.appendChild(style);

function getFolderName() {
    const path = window.location.pathname;
    return path.split('/').filter(Boolean).slice(-2, -1)[0] || "unknown";
}

function markAsDone(element) {
    localStorage.setItem(getFolderName(), new Date().toISOString());
    element.innerHTML = "‚úì";
    element.classList.add('marked');
    alert("Lli√ß√≥ marcada ‚úÖ");
}

const card = document.querySelector(".card");
const box = document.createElement("div");
box.className = "check-box-manual";

if (localStorage.getItem(getFolderName())) {
    box.innerHTML = "‚úì";
    box.classList.add('marked');
}

box.onclick = function() { markAsDone(this); };
card.appendChild(box);
</script>
</body>
</html>